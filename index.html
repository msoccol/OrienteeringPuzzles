<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Descri√ß√£o do Controle ‚Äî Vers√£o Final</title>
<style>
/* ----------------- Reset / base ----------------- */
* { box-sizing: border-box; }
body {
  font-family: Arial, Helvetica, sans-serif;
  margin: 0.8rem;
  background: #f6f8fb;
  color: #111;
  -webkit-tap-highlight-color: transparent;
}

/* header/status */
h3 { text-align:center; margin:0.6rem 0 0.5rem; font-weight:600; }
#status { text-align:center; font-size:1rem; margin-bottom:0.8rem; }

/* controls row */
#controls {
  max-width: 980px;
  margin: 0 auto 1rem;
  display:flex;
  gap:0.6rem;
  justify-content:center;
  align-items:center;
}

/* layout grid */
.container {
  max-width: 980px;
  margin: 0 auto 2rem;
  display: grid;
  grid-template-columns: 1fr 0.9fr 1fr;
  gap: 1rem;
}

/* columns */
.col {
  background: #fff;
  padding: 1rem;
  border-radius: 10px;
  min-height: 220px;
  box-shadow: 0 6px 18px rgba(8,18,30,0.06);
  overflow: visible;
}

/* images */
.img-card {
  display:flex;
  gap:0.6rem;
  align-items:center;
  margin-bottom:0.6rem;
}
.img-card img {
  width:70px;
  height:70px;
  object-fit:cover;
  border-radius:6px;
  border:1px solid #ddd;
  cursor:pointer;
  transition: transform .12s ease, border-color .12s ease;
  touch-action: manipulation;
}
.img-card img:hover { transform: scale(1.04); border-color:#aaa; }

/* label input next to image */
.rotulo { 
  flex:1;
  border:none;
  border-bottom:1px solid #e0e4ea;
  padding:6px 8px;
  font-size:0.95rem;
  background:transparent;
}

/* respostas list */
ul { list-style:none; padding:0; margin:0; }
li {
  background:#ffffff; /* agora branco por padr√£o */
  margin:6px 0;
  padding:10px 12px;
  border-radius:8px;
  cursor:grab;
  user-select:none;
  transition:opacity .12s ease, transform .08s ease;
  font-size:0.95rem;
  border: 1px solid #eef2f6;
}
li:active { transform: translateY(1px); }
li.dragging { opacity:0.6; }
li.selecionada { outline:2px solid #0b75d1; background:#eaf4ff; }
li.usada { opacity:0.45; }

/* buttons */
button {
  padding:10px 14px;
  border-radius:8px;
  border:none;
  background:#0078d7;
  color:white;
  font-size:0.98rem;
  cursor:pointer;
}
button.secondary { background:#555; }
button:disabled { background:#9aa6b8; cursor:not-allowed; }

/* painel flutuante mobile (direita, 60% width) */
#painelRespostasBtn {
  display:none;
  position:fixed;
  bottom:14px;
  right:14px;
  z-index:9999;
  border-radius:999px;
  box-shadow:0 6px 18px rgba(8,18,30,0.12);
}
#painelRespostas {
  display:none;
  position:fixed;
  top:0;
  right:0;
  height:100vh;
  width:60vw;            /* ocupa 60% da largura */
  background:#fff;       /* fundo branco */
  box-shadow:-6px 0 20px rgba(0,0,0,0.12);
  z-index:9998;
  transform: translateX(100%);
  transition: transform .28s ease;
  padding: 12px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
#painelRespostas.open {
  display:block;
  transform: translateX(0);
}

/* destaque quando travado */
.travado { opacity:0.5; cursor:not-allowed !important; }

/* responsive: mobile-first changes */
@media (max-width: 900px) {
  .container { grid-template-columns: 1fr; }
  .img-card img { max-width:160px; width:100%; height:auto; }
  .img-card { align-items:flex-start; gap:0.8rem; }
  .rotulo { font-size:1rem; width:100%; }
  li { font-size:1.05rem; padding:12px 14px; }
  button { font-size:1.02rem; padding:12px; }
  #painelRespostasBtn { display:block; background:#0078d7; color:#fff; padding:12px 16px; border:none; }
  /* ensure space to scroll last item when panel is open */
  #painelRespostas ul { padding-bottom:90px; }
  /* hide desktop central list (we use painel) */
  #respostas { display:none; }
  /* controls adjust */
  #controls { padding:0 12px; }
}

/* estilo simples para bot√µes de compartilhamento (opcional) */
#shareArea button {
  padding:10px 12px;
  border-radius:8px;
  border:none;
  background:#ff5c00;
  color:white;
  font-weight:600;
  cursor:pointer;
}
#shareArea button.secondary {
  background:#0078d7;
}

</style>
</head>
<body>

<!-- painel m√≥vel (toggle) -->
<button id="painelRespostasBtn" aria-expanded="false">Respostas ‚Üë</button>
<div id="painelRespostas" aria-hidden="true"></div>

<h3 id="instrucao">Arraste a descri√ß√£o at√© a imagem correspondente</h3>

<div id="status" style="text-align:center; font-size:1rem; margin-bottom:0.6rem;">
  <strong>Tempo:</strong> <span id="tempo">00:00.000</span> ‚Äî 
  <strong>Resultado:</strong> <span id="resultado">---</span>
</div>

<!-- √Årea de compartilhamento / imagem -->
<div id="shareArea" style="display:none; text-align:center; margin:12px 0;">
  <button id="btnCopiarFrase" style="margin-right:8px;">Copiar texto para Instagram</button>
  <button id="btnAbrirInstagram" style="margin-right:8px;">Abrir @oApurador</button>
  <button id="btnGerarImagem">Baixar imagem do resultado</button>
</div>

<!-- CONTROLES -->
<div id="controls">
  <!-- JS ir√° injetar os bot√µes aqui (sempre vis√≠veis) -->
</div>

<!-- LAYOUT -->
<div class="container" id="mainContainer">
  <div class="col" id="imagens1" aria-label="Imagens coluna 1"></div>
  <div class="col" id="respostas" aria-label="Respostas (desktop)"></div>
  <div class="col" id="imagens2" aria-label="Imagens coluna 2"></div>
</div>

<script>
/* --------------------------- CONFIG --------------------------- */
const NUM_ITENS = 12; // quantidade a sortear
const MOBILE_BREAK = 900;

/* ---------- DADOS (sua lista) ---------- */
const definirArray = () => [
  [101,'D101_Terraco.jpg','Terra√ßo, Plat√¥'],
  [102,'D102_Esporao.jpg','Espor√£o'],
  [103,'D103_Reentrancia.jpg','Reentr√¢ncia, Talvegue'],
  [104,'D104_Barranco.jpg','Barranco de Terra'],
  [105,'D105_Escavacao.jpg','Escava√ß√£o, Pedreira'],
  [106,'D106_MurrodeTerra.jpg','Muro de Terra, Talude'],
  [107,'D107_Erosao.jpg','Eros√£o, Ravina'],
  [108,'D108_ValaSeca.jpg','Vala Seca'],
  [109,'D109_Colina.jpg','Colina, Cume'],
  [110,'D110_Monticulo.jpg','Mont√≠culo, Cota'],
  [111,'D111_Passagem.jpg','Passagem, Colo'],
  [112,'D112_Depressao.jpg','Depress√£o'],
  [113,'D113_PequenaDepressao.jpg','Pequena Depress√£o'],
  [114,'D114_Buraco.jpg','Buraco'],
  [115,'D115_TerrenoIrregular.jpg','Terreno Irregular'],
  [116,'D116_Cupinzeiro.jpg','Cupinzeiro, Formigueiro'],
  [201,'D201_Falesia.jpg','Fal√©sia, Penhasco'],
  [202,'D202_PilardePedra.jpg','Pilar de Pedra'],
  [203,'D203_Caverna.jpg','Caverna'],
  [204,'D204_Pedra.jpg','Pedra'],
  [205,'D205_Pedregulho.jpg','Pedregulho, Campo de Pedras'],
  [206,'D206_MontedePedras.jpg','Monte de Pedras'],
  [207,'D207_CampoPedregoso.jpg','Campo Pedregoso'],
  [208,'D208_AfloramentoRochoso.jpg','Afloramento Rochoso'],
  [209,'D209_PassagemEstreita.jpg','Passagem Estreita'],
  [210,'D210_Trincheira.jpg','Trincheira'],
  [301,'D301_Lago.jpg','Lago'],
  [302,'D302_LagoPequeno.jpg','Lago Pequeno, Lagoa'],
  [303,'D303_BuracoComAgua.jpg','Buraco com √Ågua'],
  [304,'D304_Rio.jpg',"Rio, Curso d√°gua"],
  [305,'D305_CursoDaguaTemporario.jpg',"Curso d√°gua tempor√°rio"],
  [306,'D306_CharcoEstreito.jpg','Charco Estreito'],
  [307,'D307_Charco.jpg','Charco, P√¢ntano'],
  [308,'D308_TerrnoFirmeEntreCharco.jpg','Terreno Firme entre Charco'],
  [309,'D310_Nascente.jpg','Nascente'],
  [310,'D309_Poco.jpg','Po√ßo'],
  [311,'D311_TanqueComAgua.jpg','Tanque com √Ågua'],
  [401,'D401_AreaAberta.jpg','√Årea Aberta'],
  [402,'D402_AreaSemiAberta.jpg','√Årea Semi Aberta'],
  [403,'D403_CantodeFloresta.jpg','Canto de Floresta'],
  [404,'D404_Clareira.jpg','Clareira'],
  [405,'D405_Matagal.jpg','Matagal, Moita'],
  [406,'D406_Sebe.jpg','Sebe, Renque Linear'],
  [407,'D407_BordadeVegetacao.jpg','Borda de Vegeta√ß√£o'],
  [408,'D408_Bosque.jpg','Bosque'],
  [409,'D409_ArvoreDistinta.jpg','√Årvore Distinta'],
  [410,'D410_TocodeArvore.jpg','Toco de √Årvore, Raiz'],
  [501,'D501_Estrada.jpg','Estrada'],
  [502,'D502_Caminho.jpg','Caminho, Carreiro'],
  [503,'D503_Aceiro.jpg','Aceiro, Picada'],
  [504,'D504_Ponte.jpg','Ponte'],
  [505,'D505_RedeEletrica.jpg','Rede El√©trica'],
  [506,'D506_Poste.jpg','Poste'],
  [507,'D507_Tunel.jpg','T√∫nel'],
  [508,'D508_MurodePedra.jpg','Muro de Pedra'],
  [509,'D509_Cerca.jpg','Cerca'],
  [510,'D510_PontodePassagem.jpg','Ponto de Passagem'],
  [511,'D511_Edificacao.jpg','Edifica√ß√£o'],
  [512,'D512_AreaPavimentada.jpg','√Årea Pavimentada'],
  [513,'D513_Ruinas.jpg','Ru√≠nas'],
  [514,'D514_Conduto.jpg','Conduto, Tubula√ß√£o'],
  [515,'D515_Torre.jpg','Torre'],
  [516,'D516_PlataformadeTiro.jpg','Plataforma de Tiro, Estande'],
  [517,'D517_Marco.jpg','Marco, Pedra Fundamental'],
  [518,'D518_Manjedoura.jpg','Manjedoura'],
  [519,'D519_TerrenoQueimado.jpg','√Årea de Queimadas'],
  [520,'D520_Monumento.jpg','Monumento, Est√°tua'],
  [521,'D521_PassagemSobreEdificacao.jpg','Passagem Sob Edifica√ß√£o'],
  [522,'D522_Escadaria.jpg','Escadaria'],
  [523,'D523_Canteiro.jpg','Canteiro de Flores'],
  [524,'D524_Ferrovia.jpg','Linha F√©rrea'],
  [601,'D601_ItemEspecial.jpg','√çtem Especial'],
  [602,'D602_ItemEspecial.jpg','√çtem Especial']
];

/* --------------------------- ESTADO --------------------------- */
let testeFinalizado = false;
let tempo = 0;
let timer = null;
let itemSelecionado = null;   // usado para drag (desktop)
let selectedResponse = null;  // usado para selecionar por clique/touch {id,text,li}

/* --------------------------- UTIL --------------------------- */
function isMobile() { return window.innerWidth < MOBILE_BREAK; }
function formatarTempo(msTotal) {
  const min = String(Math.floor(msTotal / 60000)).padStart(2,'0');
  const seg = String(Math.floor((msTotal % 60000) / 1000)).padStart(2,'0');
  const ms  = String(Math.floor((msTotal % 1000) /10)).padStart(2,'0');
  return `${min}:${seg}.${ms}`;
}
function iniciarCronometro() {
  if (timer) clearInterval(timer);
  tempo = 0;
  document.getElementById('tempo').textContent = '00:00:00';
  timer = setInterval(()=>{ tempo+=10; document.getElementById('tempo').textContent = formatarTempo(tempo); }, 10);
}
function pararCronometro(){ if(timer){ clearInterval(timer); timer = null; } }

/* --------------------------- RANK/RESULT (simples) --------------------------- */
function checarRespostas(){
  if (testeFinalizado) return;
  pararCronometro();

  const inputs = document.querySelectorAll('.rotulo');
  const total = inputs.length;
  let acertos = 0;
  inputs.forEach(inp => { const id = inp.id.replace('rot',''); if (inp.dataset.resp === id) acertos++; });

  document.getElementById('resultado').textContent = `${acertos} / ${total}`;
  testeFinalizado = true;
  travarTeste();
  
  // mostrar funcionalidades de compartilhar / baixar imagem
  mostrarShareArea(acertos);
}

/* --------------------------- BLOQUEIOS --------------------------- */
function travarTeste(){
  document.querySelectorAll('.rotulo').forEach(i=> i.disabled=true);
  document.querySelectorAll('#imagens1 img, #imagens2 img').forEach(im=> { im.style.pointerEvents='none'; im.classList.add('travado');});
  document.querySelectorAll('#respostas li, #painelRespostas li').forEach(li=> { li.draggable = false; li.style.pointerEvents='none'; li.classList.add('travado');});
  const b = document.getElementById('btn-verificar'); if(b){ b.disabled=true; b.style.background='#888';}
}

/* --------------------------- OPACIDADE / USO (APLICA A TODOS os li com o mesmo data-id) --------------------------- */
function atualizarOpacidadeResposta(idResposta){
  if(!idResposta) return;
  const aindaUsada = [...document.querySelectorAll('.rotulo')].some(c => c.dataset.resp === idResposta);
  // aplicar a todos os li com esse id (desktop e painel m√≥vel)
  document.querySelectorAll(`li[data-id="${idResposta}"]`).forEach(li => {
    li.classList.toggle('usada', !!aindaUsada);
  });
}

/* --------------------------- SORT / MONTAR --------------------------- */
function sortear(qtd){
  const dados = definirArray();
  if(qtd > dados.length) qtd = dados.length;
  return dados.sort(()=>0.5 - Math.random()).slice(0,qtd);
}

function montarTeste(qtd){
  // reset estado
  testeFinalizado = false;
  pararCronometro();
  itemSelecionado = null;
  selectedResponse = null;

  // limpa √°reas
  document.getElementById('imagens1').innerHTML = '';
  document.getElementById('imagens2').innerHTML = '';
  document.getElementById('respostas').innerHTML = '';
  document.getElementById('painelRespostas').innerHTML = '';
  document.getElementById('resultado').textContent = '---';

  // gerar dados
  const sorteados = sortear(qtd);
  const imagens = sorteados.map(d => ({id: String(d[0]), src: 'Controles/' + d[1]}));
  const respostas = sorteados.map(d => ({id: String(d[0]), text: d[2]}));
  const metade = Math.ceil(imagens.length / 2);

  // montar imagens (colocar inputs)
  imagens.forEach((imgObj, idx) => {
    const container = document.createElement('div');
    container.className = 'img-card';

    const img = document.createElement('img');
    img.src = imgObj.src;
    img.alt = imgObj.id;
    img.dataset.id = imgObj.id;
    img.draggable = false; // imagens n√£o s√£o arrastadas
    img.style.touchAction = 'manipulation';

    // imagem click/touch behavior (desktop: can be drop target or click-to-paste; mobile: click-to-paste)
    img.addEventListener('click', (e) => {
      e.preventDefault();
      if(selectedResponse) {
        colarViaSelecao(img.dataset.id);
      }
    });
    img.addEventListener('touchstart', (e) => {
      if(selectedResponse) { e.preventDefault(); colarViaSelecao(img.dataset.id); }
    }, {passive:false});

    const rot = document.createElement('input');
    rot.type = 'text';
    rot.className = 'rotulo';
    rot.id = 'rot' + imgObj.id;
    rot.autocomplete = 'off';
    rot.readOnly = true; // read-only so user can't type; answers only via UI
    rot.dataset.resp = ''; // id da resposta associada

    container.appendChild(img);
    container.appendChild(rot);

    if(idx < metade) document.getElementById('imagens1').appendChild(container);
    else document.getElementById('imagens2').appendChild(container);
  });

  // montar lista de respostas (ul)
  const ul = document.createElement('ul');
  // embaralhar respostas
  respostas.sort(()=>0.5 - Math.random()).forEach(r => {
    const li = document.createElement('li');
    li.textContent = r.text;
    li.dataset.id = r.id;
    // draggable s√≥ no desktop
    if(!isMobile()){
      li.draggable = true;
      li.addEventListener('dragstart', (ev) => {
        itemSelecionado = { id: r.id, text: r.text };
        li.classList.add('dragging');
        try { ev.dataTransfer.setData('text/plain', JSON.stringify(itemSelecionado)); } catch(e){}
      });
      li.addEventListener('dragend', () => li.classList.remove('dragging'));
    } else {
      li.draggable = false;
    }

    // click / touch to select (works both mobile and desktop)
    li.addEventListener('click', (ev) => {
      ev.preventDefault();
      selecionarPorClique(r.id, r.text, li);
    });
    li.addEventListener('touchstart', (ev) => {
      ev.preventDefault();
      selecionarPorClique(r.id, r.text, li);
    }, {passive:false});

    ul.appendChild(li);
  });

  // inserir lista na √°rea correta dependendo do device
  if(isMobile()){
    // painel m√≥vel
    const painel = document.getElementById('painelRespostas');
    painel.innerHTML = '';
    painel.appendChild(ul);
    document.getElementById('painelRespostasBtn').style.display = 'block';
    // ensure hidden by default
    painel.classList.remove('open');
    document.getElementById('painelRespostasBtn').setAttribute('aria-expanded','false');
    document.getElementById('painelRespostasBtn').onclick = () => {
      painel.classList.toggle('open');
      const exp = painel.classList.contains('open');
      document.getElementById('painelRespostasBtn').setAttribute('aria-expanded', exp);
    };
  } else {
    const respostasArea = document.getElementById('respostas');
    respostasArea.innerHTML = '';
    respostasArea.appendChild(ul);
    // hide mobile toggles
    document.getElementById('painelRespostasBtn').style.display = 'none';
    document.getElementById('painelRespostas').classList.remove('open');
  }

  /* ------------- habilita drop targets (desktop only) ------------- */
  if(!isMobile()){
    document.querySelectorAll('#imagens1 img, #imagens2 img').forEach(img => {
      img.addEventListener('dragover', e => e.preventDefault());
      img.addEventListener('drop', e => {
        e.preventDefault();
        let payload = null;
        try { payload = JSON.parse(e.dataTransfer.getData('text/plain')); } catch(err){ payload = itemSelecionado; }
        if(!payload) return;

        const campo = document.getElementById('rot' + img.dataset.id);
        const respostaAntiga = campo.dataset.resp;

        // aplicar nova resposta
        campo.value = payload.text;
        campo.dataset.resp = payload.id;

        // marcar a nova como usada (aplica a todos os lis com esse data-id)
        document.querySelectorAll(`li[data-id="${payload.id}"]`).forEach(x => x.classList.add('usada'));

        // restaurar opacidade da antiga (se necess√°rio)
        if(respostaAntiga) atualizarOpacidadeResposta(respostaAntiga);
      });
    });
  }

  // sempre criar/atualizar os bot√µes no controls
  montarBotoes();
  
  // ESCONDER √ÅREA DE COMPARTILHAMENTO
    document.getElementById('shareArea').style.display = 'none';
	
  // iniciar cronometro
  iniciarCronometro();
}

/* --------------------------- sele√ß√£o por clique/touch --------------------------- */
function selecionarPorClique(id, text, liEl){
  if(testeFinalizado) return;
  // desmarca visual de sele√ß√£o anterior
  document.querySelectorAll('li').forEach(x => x.classList.remove('selecionada'));
  selectedResponse = { id: String(id), text, liEl };
  if(liEl) liEl.classList.add('selecionada');
}

/* colar via sele√ß√£o (quando imagem √© clicada ap√≥s selecionar resposta) */
function colarViaSelecao(imgId){
  if(testeFinalizado || !selectedResponse) return;
  const campo = document.getElementById('rot' + imgId);
  const respostaAntiga = campo.dataset.resp;

  // aplica a nova
  campo.value = selectedResponse.text;
  campo.dataset.resp = selectedResponse.id;

  // marca nova como usada (em todas as listas)
  document.querySelectorAll(`li[data-id="${selectedResponse.id}"]`).forEach(x => x.classList.add('usada'));

  // atualiza a antiga (se necess√°rio) ‚Äî isso remove 'usada' se n√£o estiver em uso em nenhum campo
  if(respostaAntiga) atualizarOpacidadeResposta(respostaAntiga);

  // limpa sele√ß√£o visual
  if(selectedResponse.liEl) selectedResponse.liEl.classList.remove('selecionada');
  selectedResponse = null;
}
/* --------------------------- COMPARTILHAR / GERAR IMAGEM --------------------------- */

/**
 * Texto que ser√° copiado para Instagram (com @oApurador)
 * Voc√™ pode ajustar a mensagem aqui.
 */
function montarTextoCompartilhamento(acertos, tempoFormatado) {
  return `Acabei de fazer o teste de orienta√ß√£o e acertei ${acertos} respostas! üèÅ\n` +
         `Tempo: ${tempoFormatado} ‚è±\n` +
         `Teste feito no @oApurador\n#Orienteering #oApurador`;
}

/**
 * Mostrar area de compartilhamento quando o teste terminar
 */
function mostrarShareArea(acertos) {
  const share = document.getElementById('shareArea');
  share.style.display = 'block';

  // (re)atribui behavior dos bot√µes
  const btnCopy = document.getElementById('btnCopiarFrase');
  const btnOpen = document.getElementById('btnAbrirInstagram');
  const btnImage = document.getElementById('btnGerarImagem');

  // preparar texto atual
  const tempoFormatado = document.getElementById('tempo').textContent || formatarTempo(tempo);
  const texto = montarTextoCompartilhamento(acertos, tempoFormatado);

  btnCopy.onclick = async () => {
    try {
      await navigator.clipboard.writeText(texto);
      alert('Texto copiado! Agora cole no seu post ou story do Instagram.');
    } catch (err) {
      // fallback
      const ta = document.createElement('textarea'); ta.value = texto;
      document.body.appendChild(ta); ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert('Texto copiado para a √°rea de transfer√™ncia.');
    }
  };

  btnOpen.onclick = () => {
    // abre o perfil do instagram em nova aba (ou app em mobile)
    window.open('https://instagram.com/oApurador', '_blank');
  };

  btnImage.onclick = () => {
    //const msTempo = tempo; // pega o tempo global em ms
    gerarImagemResultado(acertos, NUM_ITENS, tempoFormatado);
  };
}

/**
 * Gera imagem PNG em canvas com tema "mapa de orienta√ß√£o" e for√ßa download.
 * - acertos: n√∫mero de acertos (int)
 * - tempoMs: tempo em milissegundos (int)
 */
async function gerarImagemResultado(acertos, total, tempo) {
  const canvas = document.getElementById('resultadoCanvas');
  const ctx = canvas.getContext('2d');

  const W = canvas.width;
  const H = canvas.height;

  // ---- FUNDO (MAPA DE ORIENTA√á√ÉO) ----
  const bg = new Image();
  bg.src = "mapa.png"; // <--- ALTERE AQUI

  await new Promise(res => { bg.onload = res; });

  ctx.drawImage(bg, 0, 0, W, H);

  // ---- CARD CENTRAL ----
  const cardW = W * 0.82;
  const cardH = H * 0.45;
  const cardX = (W - cardW) / 2;
  const cardY = H * 0.28;

  // gradiente 45¬∞
  const grad = ctx.createLinearGradient(cardX, cardY, cardX + cardW, cardY + cardH);
  grad.addColorStop(0, "#ff8c3c");
  grad.addColorStop(1, "#ffffff");

  ctx.fillStyle = grad;
  ctx.strokeStyle = "#00000055";
  ctx.lineWidth = 8;
  ctx.beginPath();
  ctx.roundRect(cardX, cardY, cardW, cardH, 40);
  ctx.fill();
  ctx.stroke();

  // ---- TEXTO ----
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";
  ctx.font = "40px Arial Black";
  ctx.fillText("DESCRI√á√ÉO DE CONTROLE", W / 2, cardY + 120);
  ctx.font = "80px Arial Black";
  ctx.fillText("RESULTADO", W / 2, cardY + 200);

  ctx.font = "140px Arial Black";
  ctx.fillStyle = "#c84b00";
  ctx.fillText(`${acertos}/${total}`, W / 2, H/2);

  ctx.fillStyle = "#000";
  ctx.font = "80px Arial";
  ctx.fillText(`Tempo: ${tempo}`, W / 2, H/2 + 120);

   // ---- @oApurador footer
  ctx.font = '700 30px "Arial"';
  ctx.fillStyle = '#0b3b1f';
  ctx.fillText('Teste criado pelo', W/2, cardY + cardH - 150);
  ctx.fillStyle = '#0b66c2';
  ctx.font = '800 40px "Arial"';
  ctx.fillText('@oApurador', W/2, cardY + cardH - 100);
  
  // ---- SALVAR IMAGEM ----
  const link = document.createElement("a");
  link.download = "resultado_teste.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}


/* --------------------------- BOT√ïES --------------------------- */
function montarBotoes(){
  const controls = document.getElementById('controls');
  controls.innerHTML = ''; // limpar

  const btnVer = document.createElement('button');
  btnVer.id = 'btn-verificar';
  btnVer.textContent = 'Verificar Respostas';
  btnVer.addEventListener('click', checarRespostas);
  controls.appendChild(btnVer);

  const btnNovo = document.createElement('button');
  btnNovo.className = 'secondary';
  btnNovo.textContent = 'Novo Teste';
  btnNovo.addEventListener('click', ()=>{ montarTeste(NUM_ITENS); });
  controls.appendChild(btnNovo);
}

/* --------------------------- inicializa√ß√£o / instru√ß√£o responsiva --------------------------- */
function ajustarInstrucao(){
  const h = document.getElementById('instrucao');
  if(isMobile()) h.textContent = 'Toque na resposta para selecionar e depois toque na imagem para colar';
  else h.textContent = 'Arraste a descri√ß√£o at√© a imagem correspondente (ou clique para selecionar/colar)';
}

/* --------------------------- inicio --------------------------- */
window.addEventListener('DOMContentLoaded', ()=>{
  ajustarInstrucao();
  montarTeste(NUM_ITENS);
  // ensure body mobile flag
  document.body.dataset._mobile = isMobile() ? '1' : '0';
});
window.addEventListener('resize', ()=> {
  const wasMobile = document.body.dataset._mobile === '1';
  const nowMobile = isMobile();
  document.body.dataset._mobile = nowMobile ? '1' : '0';
  ajustarInstrucao();
  // if breakpoint toggled, rebuild to reattach handlers correctly
  if((nowMobile && !wasMobile) || (!nowMobile && wasMobile)){
    montarTeste(NUM_ITENS);
  }
});

</script>
<canvas id="resultadoCanvas" width="1080" height="1920" style="display:none;"></canvas>

</body>
</html>

