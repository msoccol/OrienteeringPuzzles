<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Descrição do Controle</title>
<style>
.travado {
  opacity: 0.5;
  cursor: not-allowed !important;
}

body {
  font-family: Arial, sans-serif;
  margin: 0.7rem;
  background: #f8f8f8;
}

h3 {
  text-align: center;
  margin-bottom: 1rem;
}

.container {
  display: grid;
  grid-template-columns: 1fr 0.8fr 1fr;
  gap: 1rem;
}

/* ---------  MOBILE --------- */
@media (max-width: 900px) {
  .container {
    grid-template-columns: 1fr;
  }

  img {
    width: 100%;
    height: auto;
    max-width: 160px;
  }

  .col div {
    display: flex;
    gap: 0.6rem;
    align-items: center;
    margin-bottom: 0.8rem;
  }

  input.rotulo {
    width: 100%;
    font-size: 1rem;
  }

  li {
    font-size: 1.1rem;
    padding: 14px;
  }

  button {
    font-size: 1.1rem;
    padding: 14px;
  }
  
  #painelRespostasBtn {
    display: block; 
  }
  
  #respostas {
    display: none; /* seu painel móvel usa painelRespostas */
  } /* esconder respostas originais */
  
  #controls {
    padding: 0 1rem;
  }
  
  #painelRespostas ul {
    padding-bottom: 80px; /* garante espaço para o botão */
    position: fixed;
    bottom: 60px; /* deixa espaço para o botão */
    right: 0;
    left: 0;
  }
  
  #painelRespostas {
    max-height: 60vh;       /* aumenta área visível */
    overflow-y: auto;       /* rolagem suave */
    -webkit-overflow-scrolling: touch; /* melhora no iPhone/iPad */
    padding: 1rem;
    touch-action: pan-y;    /* deixa o gesto de rolar mais natural */
  }
}

/* ---------------------------------- */

.col {
  background: #fff;
  padding: 1rem;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  min-height: 200px;
}

img {
  width: 70px;
  height: 70px;
  margin: 5px;
  border: 2px solid #ddd;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.2s;
}

img:hover {
  transform: scale(1.05);
  border-color: #aaa;
}

ul {
  list-style-type: none;
  padding: 0;
}

li {
  background: #eee;
  margin: 6px 0;
  padding: 10px;
  border-radius: 5px;
  cursor: grab;
  user-select: none;
  transition: 0.2s;
}

li.dragging {
  opacity: 0.6;
}

input.rotulo {
  width: 80%;
  margin-left: 8px;
  border: none;
  border-bottom: 1px solid #ccc;
  background: transparent;
  font-size: 0.9rem;
}

button {
  margin-top: 1rem;
  width: 100%;
  padding: 10px;
  font-size: 1rem;
  background: #0078d7;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #005fa3;
}
/* Painel flutuante de respostas */
#painelRespostasBtn {
  display: none; /* só aparece no mobile */
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: #0078d7;
  color: white;
  padding: 14px 18px;
  border-radius: 50px;
  font-size: 1rem;
  border: none;
  z-index: 9999;
}

#painelRespostas {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-top: 2px solid #ccc;
  padding: 1rem;
  max-height: 50%;
  overflow-y: auto;
  display: none;
  z-index: 9998;
}



/* garante que os controles (botões) apareçam em mobile */
#controls {
  display: flex;
  gap: 0.6rem;
  justify-content: center;
  align-items: center;
}


/* destaque visual quando uma resposta estiver selecionada */
li.selecionada {
  outline: 2px solid #0078d7;
  background: #e6f0fb;
}



</style>
</head>
<body>
<button id="painelRespostasBtn">Respostas ↑</button>
<div id="painelRespostas"></div>

<h3>Arraste a descrição até a imagem correspondente</h3>
<div id="status" style="text-align:center; font-size:1.2rem; margin-bottom:1rem;">
  <b>Tempo:</b> <span id="tempo">00:00:00</span> —
  <b>Resultado:</b> <span id="resultado">---</span>
</div>
<!-- CONTROLES (sempre visível) -->
<div id="controls" style="max-width:900px;margin:0.5rem auto 1rem; display:flex; gap:0.5rem; align-items:center;">
  <!-- os botões serão inseridos via JS neste contêiner para garantir visibilidade no mobile -->
</div>

<!-- botão de abrir painel já existente (se já tiver, ignore) -->
<button id="painelRespostasBtn" aria-expanded="false" style="display:none; position:fixed; bottom:10px; right:10px; z-index:9999;">Respostas ↑</button>
<div id="painelRespostas" style="display:none; z-index:9998;"></div>

<div class="container">
  <div class="col" id="imagens1"></div>
  <div class="col" id="respostas"></div>
  <div class="col" id="imagens2"></div>
</div>

<script>
const quantidade = 12;

const definirArray = () => [
  [101,'D101_Terraco.jpg','Terraço, Platô'],
  [102,'D102_Esporao.jpg','Esporão'],
  [103,'D103_Reentrancia.jpg','Reentrância, Talvegue'],
  [104,'D104_Barranco.jpg','Barranco de Terra'],
  [105,'D105_Escavacao.jpg','Escavação, Pedreira'],
  [106,'D106_MurrodeTerra.jpg','Muro de Terra, Talude'],
  [107,'D107_Erosao.jpg','Erosão, Ravina'],
  [108,'D108_ValaSeca.jpg','Vala Seca'],
  [109,'D109_Colina.jpg','Colina, Cume'],
  [110,'D110_Monticulo.jpg','Montículo, Cota'],
  [111,'D111_Passagem.jpg','Passagem, Colo'],
 [112,'D112_Depressao.jpg','Depressão'],
 [113,'D113_PequenaDepressao.jpg','Pequena Depressão'],
 [114,'D114_Buraco.jpg','Buraco'],
 [115,'D115_TerrenoIrregular.jpg','Terreno Irregular'],
 [116,'D116_Cupinzeiro.jpg','Cupinzeiro, Formigueiro'],
 [201,'D201_Falesia.jpg','Falésia, Penhasco'],
 [202,'D202_PilardePedra.jpg','Pilar de Pedra'],
 [203,'D203_Caverna.jpg','Caverna'],
 [204,'D204_Pedra.jpg','Pedra'],
 [205,'D205_Pedregulho.jpg','Pedregulho, Campo de Pedras'],
 [206,'D206_MontedePedras.jpg','Monte de Pedras'],
 [207,'D207_CampoPedregoso.jpg','Campo Pedregoso'],
 [208,'D208_AfloramentoRochoso.jpg','Afloramento Rochoso'],
 [209,'D209_PassagemEstreita.jpg','Passagem Estreita'],
 [210,'D210_Trincheira.jpg','Trincheira'],
 [301,'D301_Lago.jpg','Lago'],
 [302,'D302_LagoPequeno.jpg','Lago Pequeno, Lagoa'],
 [303,'D303_BuracoComAgua.jpg','Buraco com Água'],
 [304,'D304_Rio.jpg',"Rio, Curso dágua"],
 [305,'D305_CursoDaguaTemporario.jpg',"Curso dágua temporário"],
 [306,'D306_CharcoEstreito.jpg','Charco Estreito'],
 [307,'D307_Charco.jpg','Charco, Pântano'],
 [308,'D308_TerrnoFirmeEntreCharco.jpg','Terreno Firme entre Charco'],
 [309,'D310_Nascente.jpg','Nascente'],
 [310,'D309_Poco.jpg','Poço'],
 [311,'D311_TanqueComAgua.jpg','Tanque com Água'],
 [401,'D401_AreaAberta.jpg','Área Aberta'],
 [402,'D402_AreaSemiAberta.jpg','Área Semi Aberta'],
 [403,'D403_CantodeFloresta.jpg','Canto de Floresta'],
 [404,'D404_Clareira.jpg','Clareira'],
 [405,'D405_Matagal.jpg','Matagal, Moita'],
 [406,'D406_Sebe.jpg','Sebe, Renque Linear'],
 [407,'D407_BordadeVegetacao.jpg','Borda de Vegetação'],
 [408,'D408_Bosque.jpg','Bosque'],
 [409,'D409_ArvoreDistinta.jpg','Árvore Distinta'],
 [410,'D410_TocodeArvore.jpg','Toco de Árvore, Raiz'],
 [501,'D501_Estrada.jpg','Estrada'],
 [502,'D502_Caminho.jpg','Caminho, Carreiro'],
 [503,'D503_Aceiro.jpg','Aceiro, Picada'],
 [504,'D504_Ponte.jpg','Ponte'],
 [505,'D505_RedeEletrica.jpg','Rede Elétrica'],
 [506,'D506_Poste.jpg','Poste'],
 [507,'D507_Tunel.jpg','Túnel'],
 [508,'D508_MurodePedra.jpg','Muro de Pedra'],
 [509,'D509_Cerca.jpg','Cerca'],
 [510,'D510_PontodePassagem.jpg','Ponto de Passagem'],
 [511,'D511_Edificacao.jpg','Edificação'],
 [512,'D512_AreaPavimentada.jpg','Área Pavimentada'],
 [513,'D513_Ruinas.jpg','Ruínas'],
 [514,'D514_Conduto.jpg','Conduto, Tubulação'],
 [515,'D515_Torre.jpg','Torre'],
 [516,'D516_PlataformadeTiro.jpg','Plataforma de Tiro, Estande'],
 [517,'D517_Marco.jpg','Marco, Pedra Fundamental'],
 [518,'D518_Manjedoura.jpg','Manjedoura'],
 [519,'D519_TerrenoQueimado.jpg','Área de Queimadas'],
 [520,'D520_Monumento.jpg','Monumento, Estátua'],
 [521,'D521_PassagemSobreEdificacao.jpg','Passagem Sob Edificação'],
 [522,'D522_Escadaria.jpg','Escadaria'],
 [523,'D523_Canteiro.jpg','Canteiro de Flores'],
 [524,'D524_Ferrovia.jpg','Linha Férrea'],
 [601,'D601_ItemEspecial.jpg','Ítem Especial'],
 [601,'D602_ItemEspecial.jpg','Ítem Especial']

];

let testeFinalizado = false;

function travarTeste() {
   // desabilita inputs
  document.querySelectorAll('#respostas input').forEach(inp => {
    inp.disabled = true;
    inp.classList.add('travado');
  });

  // trava imagens
  document.querySelectorAll('#imagens1 img, #imagens2 img').forEach(img => {
    img.style.pointerEvents = 'none';
    img.classList.add('travado');
  });

  // trava itens arrastáveis
  document.querySelectorAll('#respostas li').forEach(li => {
    li.draggable = false;
    li.style.pointerEvents = 'none';
    li.classList.add('travado');
  });

  // desabilita botão
  const botao = document.getElementById('btn-verificar');
  if (botao) {
    botao.disabled = true;
    botao.style.background = '#888';
    botao.style.cursor = 'not-allowed';
  }
}

let tempo = 0;        // tempo total em milissegundos
let timer = null;
let selectedResponse = null; // { id, text, liEl } resposta selecionada por clique/touch

function formatarTempo(msTotal) {
  const min = String(Math.floor(msTotal / 60000)).padStart(2, "0");
  const seg = String(Math.floor((msTotal % 60000) / 1000)).padStart(2, "0");
  const ms  = String(Math.floor((msTotal % 1000) / 10)).padStart(2, "0"); // 0–99

  return `${min}:${seg}:${ms}`;
}

function iniciarCronometro() {
  if (timer) clearInterval(timer);

  tempo = 0;
  document.getElementById("tempo").textContent = "00:00:00";

  timer = setInterval(() => {
    tempo += 10; // incrementa em 10 ms
    document.getElementById("tempo").textContent = formatarTempo(tempo);
  }, 10);
}

function pararCronometro() {
  if (timer) {
    clearInterval(timer);
    timer = null;
  }
}


let itemSelecionado = null;

function sortear(qtd) {
  const dados = definirArray();
  if (qtd > dados.length) qtd = dados.length;
  return dados.sort(() => 0.5 - Math.random()).slice(0, qtd);
}

function selecionarResposta(id, text, liEl) {
  if (testeFinalizado) return;
  // desmarca qualquer anterior
  document.querySelectorAll('#respostas li, #painelRespostas li').forEach(x => x.classList.remove('selecionada'));
  selectedResponse = { id: String(id), text, liEl };
  if (liEl) liEl.classList.add('selecionada');
}

function colarRespostaEmImagem(imgId) {
  if (testeFinalizado) return;
  if (!selectedResponse) return;
  const rotEl = document.getElementById('rot' + imgId);
  if (!rotEl) return;
  rotEl.value = selectedResponse.text;
  rotEl.dataset.resp = selectedResponse.id;

  // marcar li como usada (cinza) e torná-la inativa
  if (selectedResponse.liEl) {
    selectedResponse.liEl.style.opacity = "0.4";
    //selectedResponse.liEl.style.pointerEvents = "none";
    selectedResponse.liEl.classList.remove('selecionada');
  }

  // limpar seleção
  selectedResponse = null;
}

function atualizarOpacidadeResposta(idResposta) {
  // verifica todos os campos
  const aindaUsada = [...document.querySelectorAll('input[id^="rot"]')]
    .some(campo => campo.dataset.resp === idResposta);

  const li = document.querySelector(`li[data-id="${idResposta}"]`);
  if (!li) return;

  if (aindaUsada) {
    li.style.opacity = "0.4"; // continua usada
  } else {
    li.style.opacity = "1";   // não está mais usada → volta ao normal
  }
}
function montarTeste(qtd) {
  const sorteados = sortear(qtd);
  const imagens = sorteados.map(d => [d[0], 'Controles/'+ d[1]]);
  const respostas = sorteados.map(d => [d[0], d[2]]);
  const metade = Math.ceil(imagens.length / 2);

  const imagens1 = document.getElementById('imagens1');
  const imagens2 = document.getElementById('imagens2');
  const respostasDiv = document.getElementById('respostas');
  iniciarCronometro();

  // imagens
  imagens.forEach((imgData, i) => {
    const container = document.createElement('div');
    const img = document.createElement('img');
    img.src = imgData[1];
    img.dataset.id = imgData[0];
    // para cada img
	img.style.touchAction = "manipulation";

	img.addEventListener('click', (e) => {
		e.preventDefault();
		colarRespostaEmImagem(img.dataset.id);
	});
	img.addEventListener('touchstart', (e) => {
		e.preventDefault(); // evita que o toque vire scroll/drag
		colarRespostaEmImagem(img.dataset.id);
	}, {passive:false});

    const rot = document.createElement('input');
    rot.type = 'text';
    rot.className = 'rotulo';
    rot.id = 'rot' + imgData[0];
    container.appendChild(img);
    container.appendChild(rot);
    if (i < metade) imagens1.appendChild(container);
    else imagens2.appendChild(container);
  });

  // respostas
  const ul = document.createElement('ul');
  respostas.sort(() => 0.5 - Math.random()).forEach(r => {
    const li = document.createElement('li');
    li.textContent = r[1];
    li.draggable = true;
    li.dataset.id = r[0];
    li.addEventListener('dragstart', e => {
      itemSelecionado = r;
      li.classList.add('dragging');
    });
    li.addEventListener('dragend', e => li.classList.remove('dragging'));
	// dentro do loop que cria respostas (ex.: respostas.forEach)
	li.addEventListener('click', (e) => {
		e.preventDefault();
		selecionarResposta(r[0], r[1], li);
	});
	li.addEventListener('touchstart', (e) => {
		e.preventDefault();
		selecionarResposta(r[0], r[1], li);
	}, {passive:false});

    ul.appendChild(li);
  });
  // clique para selecionar resposta (mobile e desktop)
  
document.querySelectorAll('#respostas li').forEach(li => {
  li.addEventListener('click', () => {

    // Identifica qual resposta foi clicada
    const idResposta = li.dataset.id;
    const textoResposta = li.textContent.trim();

    // Verifica se há uma imagem selecionada para receber o clique
    if (!imgSelecionada) return;

    const idImagem = imgSelecionada.dataset.id;
    const campo = document.getElementById('rot' + idImagem);

    // Guarda a resposta antiga antes de alterar
    const respostaAntiga = campo.dataset.resp;

    // Define a nova resposta
    campo.value = textoResposta;
    campo.dataset.resp = idResposta;

    // Marca a resposta nova como usada
    li.style.opacity = "0.4";

    // Atualiza a resposta antiga (se houver)
    if (respostaAntiga) {
      atualizarOpacidadeResposta(respostaAntiga);
    }
  });
});

  // após criar 'ul' com as respostas:
if (window.innerWidth < 900) {
  const painel = document.getElementById("painelRespostas");
  painel.innerHTML = "";
  painel.appendChild(ul);
  // mostrar botão e colocar toggle
  const btn = document.getElementById("painelRespostasBtn");
  btn.style.display = "block";
  btn.onclick = () => {
    painel.style.display = painel.style.display === "block" ? "none" : "block";
    btn.setAttribute('aria-expanded', painel.style.display === "block");
  };
} else {
  document.getElementById("respostas").appendChild(ul);;
}
 
	// mobile: mover lista para painel flutuante
	if (window.innerWidth < 900) {
  document.getElementById("painelRespostas").innerHTML = "";
  document.getElementById("painelRespostas").appendChild(ul);
  
  // botão abre/fecha painel
  const btn = document.getElementById("painelRespostasBtn");
  btn.onclick = () => {
    const painel = document.getElementById("painelRespostas");
    painel.style.display = painel.style.display === "block" ? "none" : "block";
  };
}

// habilita drop nas imagens
document.querySelectorAll('img').forEach(img => {
  img.addEventListener('dragover', e => e.preventDefault());

  img.addEventListener('drop', e => {
  e.preventDefault();

  if (itemSelecionado) {
    const idImagem = img.dataset.id;
    const campo = document.getElementById('rot' + idImagem);

    // Guarda a resposta antiga antes de sobrescrever
    const respostaAntiga = campo.dataset.resp;

    // Define a nova resposta
    campo.value = itemSelecionado[1];
    campo.dataset.resp = itemSelecionado[0];

    // Marca a nova como usada
    const liUsado = document.querySelector(`li[data-id="${itemSelecionado[0]}"]`);
    if (liUsado) {
      liUsado.style.opacity = "0.4";
    }

    // Atualiza opacidade da resposta antiga, se houver
    if (respostaAntiga) {
      atualizarOpacidadeResposta(respostaAntiga);
    }
  }
  });

});

	const controls = document.getElementById('controls');
	controls.innerHTML = ''; // limpa controles antigos (se houver)
	
  // botão verificar
  const botao = document.createElement('button');
  botao.textContent = 'Verificar Respostas';
  botao.id = 'btn-verificar';
  botao.addEventListener('click', checarRespostas);
  controls.appendChild(botao);
  
  //botão Novo Teste
  const botaoNovo = document.createElement('button');
  botaoNovo.textContent = 'Novo Teste';
  botaoNovo.style.background = '#555';

  botaoNovo.addEventListener('click', () => {
	  // mostrar container
	  document.querySelector('.container').style.display = 'grid';
	  
	  testeFinalizado = false;
	  
	  pararCronometro();
	  
	  // limpar tudo
	  document.getElementById('imagens1').innerHTML = '';
	  document.getElementById('imagens2').innerHTML = '';
	  document.getElementById('respostas').innerHTML = '';
	  document.getElementById('resultado').textContent = "---";

	  // montar novamente
	  montarTeste(quantidade);

	  // iniciar contagem
	  iniciarCronometro();
  });

controls.appendChild(botaoNovo);

}


function checarRespostas() {
  pararCronometro();

  const inputs = document.querySelectorAll('.rotulo');
  let total = inputs.length;
  let acertos = 0;

  inputs.forEach(inp => {
    const id = inp.id.replace('rot','');
    const resposta = inp.dataset.resp;
    if (id === resposta) acertos++;
  });

  // exibe resultado na página
  document.getElementById("resultado").textContent = `${acertos} / ${total}`;
  testeFinalizado = true;     // trava tudo
  pararCronometro();          // para o cronômetro

  travarTeste();      
}



function ajustarInstrucao() {
  const h3 = document.querySelector('h3');
  if (window.innerWidth < 900) {
    h3.textContent = 'Toque na resposta para selecionar e toque na imagem para colar';
  } else {
    h3.textContent = 'Arraste a descrição até a imagem correspondente (ou clique para selecionar/colar)';
  }
}

window.addEventListener('DOMContentLoaded', () => {
  ajustarInstrucao();
  montarTeste(quantidade);
});

window.addEventListener('resize', ajustarInstrucao);



</script>
</body>
</html>
